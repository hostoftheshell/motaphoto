jQuery(document).ready(function(t){function e(){t.ajax({url:t("#filter-form").attr("action"),type:"POST",data:t("#filter-form").serialize(),success:function(e){e.success&&(t("#photo-catalog").html(e.data.posts_html),e.data.load_more_button?t("#load-more-container").html(e.data.load_more_button):t("#load-more-container").empty())},error:function(e,t,r){console.log("Erreur AJAX:",r)}})}e(),t("#filter-form select").on("change",function(){e()}),t(document).on("click","#load-more",function(){var e=t(this).data("page");e=e,e=t("#filter-form").serialize()+"&paged="+e,t.ajax({url:t("#filter-form").attr("action"),type:"POST",data:e,success:function(e){e.success?(t("#photo-catalog").append(e.data.posts_html),e.data.load_more_button?t("#load-more-container").html(e.data.load_more_button):t("#load-more-container").empty()):console.log("Erreur:",e.data)},error:function(e,t,r){console.log("Erreur AJAX:",r)}})})}),document.addEventListener("DOMContentLoaded",()=>{function t(e){e.preventDefault();e=new FormData(e.currentTarget);e.append("action","filter_results"),fetch(ajax_filters_params.ajaxurl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{var t;e.success?(t=e.data.lightbox_images,Lightbox.loadImages(t)):console.error("Erreur dans les données de réponse:",e.data)}).catch(e=>{console.error("Échec de la requête AJAX:",e)})}function e(){var e=document.getElementById("filter-form"),e=(e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("submit",t),e.setAttribute("data-listener-attached","true")),document.getElementById("open-lightbox"));e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",t),e.setAttribute("data-listener-attached","true"))}e(),new MutationObserver(()=>{e()}).observe(document.body,{childList:!0,subtree:!0})});class Lightbox{constructor(t,e,r,a,o,n){this.images=e,this.currentPostId=r,this.postTitle=a,this.category=o,this.reference=n,this.currentIndex=this.images.findIndex(e=>e.lightbox===t),this.createLightbox(t),this.bindCloseButton(),this.bindEscapeKey(),this.bindNavigationButtons()}static init(){this.attachEventListeners(),new MutationObserver(e=>{e.forEach(e=>{0<e.addedNodes.length&&this.attachEventListeners()})}).observe(document.body,{childList:!0,subtree:!0})}static attachEventListeners(){document.querySelectorAll(".lightbox-trigger").forEach(e=>{e.hasAttribute("data-listener-attached")||(e.addEventListener("click",e=>{e.preventDefault();var t=e.currentTarget.getAttribute("href"),r=JSON.parse(e.currentTarget.getAttribute("data-images")),a=e.currentTarget.getAttribute("data-post-id"),o=e.currentTarget.getAttribute("data-post-title"),n=e.currentTarget.getAttribute("data-category"),e=e.currentTarget.getAttribute("data-reference");a?new Lightbox(t,r,a,o,n,e):console.error("L'ID du post est manquant dans le déclencheur.")}),e.setAttribute("data-listener-attached","true"))})}createLightbox(t){var e,r;this.images.find(e=>e.lightbox===t)?(r=this.reference,e=this.category,r=this.buildMarkup(t,r,e),document.body.appendChild(r),this.updateImage(t)):console.error("Aucune donnée d'image trouvée pour l'URL:",t)}buildMarkup(e,t,r){var a=document.createElement("div");return a.classList.add("lightbox"),a.innerHTML=`
            <button class="lightbox__close">Fermer</button>
            <button class="lightbox__next">Suivante</button>
            <button class="lightbox__prev">Précédente</button>
            <div class="lightbox__container">
                <img src="${e}" alt="">
                <div class="lightbox__info">
                    <p class="lightbox__reference">${t||""}</p>
                    <p class="lightbox__category">${r||""}</p>
                </div>
            </div>
        `,a}bindCloseButton(){var e=document.querySelector(".lightbox__close");e&&e.addEventListener("click",()=>this.close())}bindEscapeKey(){document.addEventListener("keydown",this.handleKeydown.bind(this))}handleKeydown(e){"Escape"!==e.key&&27!==e.keyCode||this.close()}bindNavigationButtons(){var e=document.querySelector(".lightbox__next"),t=document.querySelector(".lightbox__prev");e&&e.addEventListener("click",()=>{this.loadNextPost()}),t&&t.addEventListener("click",()=>{this.loadPrevPost()})}updateImage(e){let t=document.querySelector(".lightbox__container img"),r=document.querySelector(".lightbox__container");t&&r?(r.classList.remove("portrait"),t.src=e,e=()=>{t.naturalHeight>t.naturalWidth&&r.classList.add("portrait")},t.complete?e():t.onload=e):console.error("Élément image ou conteneur lightbox non trouvé.")}updateReference(e){var t=document.querySelector(".lightbox__reference");t?t.textContent=e||"Aucune référence":console.error("Élément référence non trouvé dans le conteneur lightbox.")}updateCategory(e){var t=document.querySelector(".lightbox__category");t?t.textContent=e:console.error("Élément catégorie non trouvé dans le conteneur lightbox.")}loadNextPost(){var e=new FormData;e.append("action","get_next_post"),e.append("filter_nonce",ajax_filters_params.nonce),e.append("current_post_id",this.currentPostId),fetch(ajax_filters_params.ajaxurl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{var t;e.success?(this.images=e.data.lightbox_images,this.currentPostId=e.data.post_id,this.reference=this.images[0].reference,this.category=e.data.category,0<this.images.length?(t=this.images[0].lightbox,this.updateImage(t),this.updateReference(this.reference),this.updateCategory(this.category)):console.error("Aucune image disponible dans le post suivant.")):console.error("Erreur lors du chargement du post suivant:",e.data)}).catch(e=>{console.error("Échec du chargement du post suivant:",e)})}loadPrevPost(){var e;ajax_filters_params&&ajax_filters_params.ajaxurl&&ajax_filters_params.nonce?((e=new FormData).append("action","get_prev_post"),e.append("filter_nonce",ajax_filters_params.nonce),e.append("current_post_id",this.currentPostId),fetch(ajax_filters_params.ajaxurl,{method:"POST",body:e}).then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")}).then(e=>{var t;e.success?e.data.has_prev_post?(this.images=e.data.lightbox_images||[],this.currentPostId=e.data.post_id,this.reference=0<this.images.length?this.images[0].reference:null,this.category=e.data.category||"",0<this.images.length?(t=this.images[0].lightbox,this.updateImage(t),this.updateReference(this.reference),this.updateCategory(this.category)):console.error("Aucune image disponible dans le post précédent.")):console.error("Aucun post précédent disponible."):console.error("Erreur lors du chargement du post précédent:",e.data.message||"Erreur inconnue")}).catch(e=>{console.error("Échec du chargement du post précédent:",e)})):console.error("Configuration AJAX manquante.")}close(){var e=document.querySelector(".lightbox");e&&document.body.removeChild(e)}}Lightbox.init();